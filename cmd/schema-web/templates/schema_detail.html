{{template "base" .}}

{{define "content"}}
<div class="page-header">
    <div style="display: flex; align-items: center; gap: 12px;">
        <a href="/schemas" class="btn btn-outline btn-sm">â† ëª©ë¡</a>
        <div>
            <h1 class="page-title">{{.Schema.Name}}</h1>
            <p class="page-subtitle">{{.Schema.Description}}</p>
        </div>
    </div>
</div>

<div class="grid-2">
    <div class="card">
        <h3 class="card-title mb-4">ğŸ“Š ìŠ¤í‚¤ë§ˆ ì •ë³´</h3>
        <table class="table">
            <tr>
                <td class="text-muted" style="width: 120px;">ID</td>
                <td><strong>#{{.Schema.ID}}</strong></td>
            </tr>
            <tr>
                <td class="text-muted">ì´ë¦„</td>
                <td><strong>{{.Schema.Name}}</strong></td>
            </tr>
            <tr>
                <td class="text-muted">íƒ€ì…</td>
                <td><span class="badge badge-primary">{{.Schema.Type}}</span></td>
            </tr>
            <tr>
                <td class="text-muted">ë²„ì „</td>
                <td><span class="badge badge-success">v{{.Schema.Version}}</span></td>
            </tr>
            <tr>
                <td class="text-muted">í˜¸í™˜ì„±</td>
                <td><span class="badge badge-warning">{{.Schema.Compatibility}}</span></td>
            </tr>
            <tr>
                <td class="text-muted">ìƒì„±ì¼</td>
                <td>{{.Schema.CreatedAt.Format "2006-01-02 15:04:05"}}</td>
            </tr>
            <tr>
                <td class="text-muted">ìˆ˜ì •ì¼</td>
                <td>{{.Schema.UpdatedAt.Format "2006-01-02 15:04:05"}}</td>
            </tr>
        </table>
    </div>

    <div class="card">
        <h3 class="card-title mb-4">ğŸ“œ ë²„ì „ íˆìŠ¤í† ë¦¬</h3>
        {{if .Versions}}
        <table class="table">
            <thead>
                <tr>
                    <th>ë²„ì „</th>
                    <th>ìƒì„±ì¼</th>
                    <th>ìƒíƒœ</th>
                </tr>
            </thead>
            <tbody>
                {{range .Versions}}
                <tr>
                    <td><span class="badge badge-success">v{{.Version}}</span></td>
                    <td class="text-muted">{{.CreatedAt.Format "2006-01-02 15:04"}}</td>
                    <td>
                        {{if eq .Version $.Schema.Version}}
                        <span class="text-primary">í˜„ì¬</span>
                        {{else}}
                        <span class="text-muted">ì´ì „</span>
                        {{end}}
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
        {{else}}
        <p class="text-muted">ë²„ì „ íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        {{end}}
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">ğŸ“ JSON ìŠ¤í‚¤ë§ˆ ì •ì˜</h3>
        <button onclick="copySchema()" class="btn btn-outline btn-sm">ğŸ“‹ ë³µì‚¬</button>
    </div>
    <div class="code-block">
        <pre id="schemaCode">{{.FormattedSchema}}</pre>
    </div>
</div>

<div class="card">
    <h3 class="card-title mb-4">ğŸ§ª ë¹ ë¥¸ ê²€ì¦</h3>
    <p class="text-muted mb-4">ì´ ìŠ¤í‚¤ë§ˆë¡œ ë°ì´í„°ë¥¼ ê²€ì¦í•´ë³´ì„¸ìš”.</p>

    <div class="form-group">
        <label class="form-label">í…ŒìŠ¤íŠ¸ ë°ì´í„° (JSON)</label>
        <textarea id="testData" class="form-textarea" placeholder='{"order_id": "ORD-001", ...}'></textarea>
    </div>

    <button onclick="validateData()" class="btn btn-primary">ê²€ì¦í•˜ê¸°</button>

    <div id="validationResult" class="mt-4" style="display: none;"></div>
</div>

<script>
function copySchema() {
    const schema = document.getElementById('schemaCode').innerText;
    navigator.clipboard.writeText(schema);
    alert('ìŠ¤í‚¤ë§ˆê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
}

async function validateData() {
    const testData = document.getElementById('testData').value;
    const resultDiv = document.getElementById('validationResult');

    if (!testData.trim()) {
        alert('í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }

    let data;
    try {
        data = JSON.parse(testData);
    } catch (err) {
        resultDiv.innerHTML = '<div class="alert alert-danger">ì˜ëª»ëœ JSON í˜•ì‹: ' + err.message + '</div>';
        resultDiv.style.display = 'block';
        return;
    }

    const response = await fetch('/api/validate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            schema_name: '{{.Schema.Name}}',
            data: data
        })
    });

    const result = await response.json();
    const validation = result.data;

    if (validation.valid) {
        resultDiv.innerHTML = '<div class="alert alert-success">âœ… ê²€ì¦ ì„±ê³µ! ë°ì´í„°ê°€ ìŠ¤í‚¤ë§ˆì™€ ì¼ì¹˜í•©ë‹ˆë‹¤.</div>';
    } else {
        let errorsHtml = '<div class="alert alert-danger"><strong>âŒ ê²€ì¦ ì‹¤íŒ¨</strong><ul style="margin-top: 10px;">';
        validation.errors.forEach(err => {
            errorsHtml += '<li>' + err + '</li>';
        });
        errorsHtml += '</ul></div>';
        resultDiv.innerHTML = errorsHtml;
    }

    resultDiv.style.display = 'block';
}
</script>
{{end}}
