{{template "base" .}}

{{define "content"}}
<div class="page-header">
    <h1 class="page-title">ìŠ¤í‚¤ë§ˆ ëª©ë¡</h1>
    <p class="page-subtitle">ë“±ë¡ëœ ëª¨ë“  ë©”ì‹œì§€ ìŠ¤í‚¤ë§ˆë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
</div>

<div class="card">
    <div class="card-header">
        <h2 class="card-title">ğŸ“‹ ë“±ë¡ëœ ìŠ¤í‚¤ë§ˆ ({{len .Schemas}}ê°œ)</h2>
        <button onclick="showRegisterModal()" class="btn btn-primary">
            + ìƒˆ ìŠ¤í‚¤ë§ˆ ë“±ë¡
        </button>
    </div>

    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>ì´ë¦„</th>
                <th>íƒ€ì…</th>
                <th>ë²„ì „</th>
                <th>í˜¸í™˜ì„±</th>
                <th>ì„¤ëª…</th>
                <th>ë“±ë¡ì¼</th>
                <th>ì‘ì—…</th>
            </tr>
        </thead>
        <tbody>
            {{range .Schemas}}
            <tr>
                <td><span class="text-muted">#{{.ID}}</span></td>
                <td>
                    <a href="/schemas/{{.Name}}">
                        <strong>{{.Name}}</strong>
                    </a>
                </td>
                <td><span class="badge badge-primary">{{.Type}}</span></td>
                <td><span class="badge badge-success">v{{.Version}}</span></td>
                <td><span class="badge badge-warning">{{.Compatibility}}</span></td>
                <td class="text-muted">{{.Description}}</td>
                <td class="text-muted">{{.CreatedAt.Format "2006-01-02 15:04"}}</td>
                <td>
                    <a href="/schemas/{{.Name}}" class="btn btn-outline btn-sm">ìƒì„¸</a>
                    <button onclick="deleteSchema('{{.Name}}')" class="btn btn-danger btn-sm">ì‚­ì œ</button>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="8" class="text-muted" style="text-align: center; padding: 40px;">
                    ë“±ë¡ëœ ìŠ¤í‚¤ë§ˆê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ìŠ¤í‚¤ë§ˆë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!
                </td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<!-- Register Modal -->
<div id="registerModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
    <div class="card" style="width: 600px; max-height: 90vh; overflow-y: auto;">
        <div class="card-header">
            <h2 class="card-title">ìƒˆ ìŠ¤í‚¤ë§ˆ ë“±ë¡</h2>
            <button onclick="hideRegisterModal()" class="btn btn-outline btn-sm">âœ•</button>
        </div>
        <form onsubmit="registerSchema(event)">
            <div class="form-group">
                <label class="form-label">ìŠ¤í‚¤ë§ˆ ì´ë¦„</label>
                <input type="text" id="schemaName" class="form-input" placeholder="ì˜ˆ: OrderEvent" required>
            </div>
            <div class="form-group">
                <label class="form-label">ì„¤ëª…</label>
                <input type="text" id="schemaDesc" class="form-input" placeholder="ìŠ¤í‚¤ë§ˆ ì„¤ëª…">
            </div>
            <div class="form-group">
                <label class="form-label">JSON ìŠ¤í‚¤ë§ˆ</label>
                <textarea id="schemaJson" class="form-textarea" placeholder='{"type": "object", "properties": {...}}'></textarea>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="hideRegisterModal()" class="btn btn-outline">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-primary">ë“±ë¡</button>
            </div>
        </form>
    </div>
</div>

<script>
function showRegisterModal() {
    document.getElementById('registerModal').style.display = 'flex';
}

function hideRegisterModal() {
    document.getElementById('registerModal').style.display = 'none';
}

async function registerSchema(e) {
    e.preventDefault();

    const name = document.getElementById('schemaName').value;
    const desc = document.getElementById('schemaDesc').value;
    const schemaStr = document.getElementById('schemaJson').value;

    let schema;
    try {
        schema = JSON.parse(schemaStr);
    } catch (err) {
        alert('ì˜ëª»ëœ JSON í˜•ì‹ì…ë‹ˆë‹¤: ' + err.message);
        return;
    }

    const response = await fetch('/api/schemas', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            name: name,
            type: 'json',
            schema: schema,
            description: desc
        })
    });

    const result = await response.json();
    if (result.success) {
        alert('ìŠ¤í‚¤ë§ˆê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
        window.location.reload();
    } else {
        alert('ë“±ë¡ ì‹¤íŒ¨: ' + result.error);
    }
}

async function deleteSchema(name) {
    if (!confirm(`"${name}" ìŠ¤í‚¤ë§ˆë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
    }

    const response = await fetch('/api/schemas/' + name, {
        method: 'DELETE'
    });

    const result = await response.json();
    if (result.success) {
        alert('ìŠ¤í‚¤ë§ˆê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
        window.location.reload();
    } else {
        alert('ì‚­ì œ ì‹¤íŒ¨: ' + result.error);
    }
}
</script>
{{end}}
